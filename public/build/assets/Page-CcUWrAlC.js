import{r as i,j as e,h as x}from"./app-CxxiVb06.js";import{A as F}from"./AuthenticatedLayout-Ca1yLvkt.js";import"./ApplicationLogo-BPvy8byy.js";const O=({product_variants:g,warehouses:m,stock_transaction:r,transaction_items:b,stock_levels:c})=>{var S,C,T;const[u,p]=i.useState(b.map(d=>{const l=g.find(a=>a.id===d.product_variant_id);return{id:d.product_variant_id,sku:l?l.sku:"Unknown SKU",quantity:d.quantity}})),[R,y]=i.useState({}),[t,I]=i.useState(r.transaction_type),[h,P]=i.useState(r.from_warehouse_id||""),[f,G]=i.useState(r.to_warehouse_id||""),[j,A]=i.useState(r.remarks||""),[D,v]=i.useState(g);i.useEffect(()=>{console.log(b),r.items&&p(r.items.map(d=>({id:d.product_variant_id,sku:d.product_variant.sku,quantity:d.quantity})))},[r]),i.useEffect(()=>{if(t==="transfer"&&h){const d=c.map(l=>l.product_variant);v(d)}else v(g)},[t,h,b]);const q=()=>{const d=u.map(l=>l.sku).filter(Boolean);return D.filter(l=>!d.includes(l.sku))},W=()=>{p([...u,{id:"",sku:"",quantity:""}])},V=d=>{p(u.filter((l,a)=>a!==d))},N=(d,l,a)=>{const o=u.map((s,n)=>n===d?{...s,[l]:a}:s);p(o)},E=(d,l,a)=>{const o=u.map((s,n)=>n===d?{...s,sku:l,id:a}:s);p(o),y(s=>({...s,[d]:!1}))},w=d=>{y(l=>({...l,[d]:!l[d]}))},U=d=>{d.preventDefault();const l={transaction_type:t,remarks:j,from_warehouse_id:t==="transfer"?h:null,to_warehouse_id:f,products:u.map(a=>({product_variant_id:a.id,quantity:a.quantity}))};x.put(`/inventory/stock/transactions/${r.id}`,l)},K=d=>{d.preventDefault(),x.post(`/inventory/stock/transactions/pending/${r.id}`)},L=d=>{d.preventDefault(),x.post(`/inventory/stock/transactions/approve/${r.id}`)},$=d=>{d.preventDefault(),x.post(`/inventory/stock/transactions/reject/${r.id}`)};return e.jsx(F,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Stock Transactions"}),children:e.jsx("div",{className:"py-12 flex justify-center",children:e.jsxs("div",{className:"w-full max-w-4xl bg-white shadow-lg rounded-lg p-8 border border-gray-200",children:[e.jsxs("div",{className:"flex w-full justify-between mb-6 border-b pb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Stock Transaction"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Transaction ID: #",r.id]})]}),e.jsxs("div",{className:"space-x-2",children:[(r==null?void 0:r.status)==="draft"&&e.jsx("button",{onClick:K,className:"bg-green-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Submit"}),(r==null?void 0:r.status)==="pending"&&e.jsx("button",{onClick:L,className:"bg-green-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Approved"}),(r==null?void 0:r.status)!="approved"&&(r==null?void 0:r.status)!="rejected"&&e.jsx("button",{onClick:$,className:"bg-red-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Reject"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 font-semibold",children:"Status:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:r.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 font-semibold",children:"Created At:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:new Date(r.created_at).toLocaleString()})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 font-bold",children:"Transaction Type:"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:t})]}),e.jsx("div",{className:"mb-6",children:t==="transfer"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Source Warehouse:"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",children:((S=m.find(d=>d.id===h))==null?void 0:S.name)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Target Warehouse:"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",children:((C=m.find(d=>d.id===f))==null?void 0:C.name)||""})]})]}):e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Warehouse:"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",children:((T=m.find(d=>d.id===f))==null?void 0:T.name)||""})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 font-bold",children:"General Remarks:"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",value:j,onChange:d=>A(d.target.value),disabled:(r==null?void 0:r.status)!=="draft"})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg h-[500px] overflow-y-auto mb-6 shadow-sm",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-3 text-gray-600",children:"Product SKU"}),t==="transfer"&&e.jsx("th",{className:"border px-4 py-3 text-gray-600",children:"Available Stock"}),e.jsx("th",{className:"border px-4 py-3 text-gray-600",children:"Quantity"}),e.jsx("th",{className:"border px-4 py-3 text-gray-600",hidden:(r==null?void 0:r.status)!=="draft",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.map((d,l)=>{var o;const a=((o=c.find(s=>s.product_variant_id===d.id))==null?void 0:o.total_stock)||0;return e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsxs("td",{className:"border px-4 py-2 relative",children:[e.jsx("input",{type:"text",className:"w-full border px-2 py-1 rounded",placeholder:"Search SKU",value:d.sku,onChange:s=>{N(l,"sku",s.target.value),w(l)},onFocus:()=>w(l),disabled:(r==null?void 0:r.status)!=="draft"}),R[l]&&e.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:q().filter(s=>s.sku.toLowerCase().includes(d.sku.toLowerCase())).map(s=>e.jsx("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>E(l,s.sku,s.id),disabled:(r==null?void 0:r.status)!=="draft",children:s.sku},s.id))})]}),t==="transfer"&&e.jsx("td",{className:"border px-4 py-2 text-center",children:a>0?e.jsxs("span",{className:"text-green-600 font-bold",children:[a," Available"]}):e.jsx("span",{className:"text-red-600 font-bold",children:"Out of Stock"})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("input",{type:"number",className:"border rounded px-3 py-1 w-full focus:ring-2 focus:ring-blue-400 transition",value:d.quantity,onChange:s=>{let n=parseInt(s.target.value,10)||0;t==="transfer"&&n>a&&(n=a),N(l,"quantity",n)},min:"1",max:t==="transfer"?a:"",disabled:(r==null?void 0:r.status)!=="draft"})}),e.jsx("td",{className:"border px-4 py-2",hidden:(r==null?void 0:r.status)!=="draft",children:e.jsx("button",{type:"button",onClick:()=>V(l),className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition",children:"Remove"})})]},l)})})]})}),e.jsx("div",{className:"flex justify-between items-center",children:(r==null?void 0:r.status)==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:W,className:"bg-blue-500 text-white px-5 py-2 rounded-lg shadow hover:bg-blue-600 transition",children:"Add Product"}),e.jsx("button",{onClick:U,className:"bg-green-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Save Changes"})]})})]})})})};export{O as default};
