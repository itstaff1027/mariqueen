import{r as u,j as e,h as x}from"./app-B1sjvdko.js";import{A as F}from"./AuthenticatedLayout-Bmz7T_3p.js";import"./ApplicationLogo-lMO7AezW.js";const M=({product_variants:p,warehouses:b,stock_transaction:r,transaction_items:j,stock_levels:I})=>{var T,R,A;const[i,h]=u.useState(j.map(s=>{const l=p.find(d=>d.id===s.product_variant_id);return{id:s.product_variant_id,sku:l?l.sku:"Unknown SKU",quantity:s.quantity}})),[v,N]=u.useState({}),[t,z]=u.useState(r.transaction_type),[c,B]=u.useState(r.from_warehouse_id||""),[f,G]=u.useState(r.to_warehouse_id||""),[w,D]=u.useState(r.remarks||""),[Q,S]=u.useState(p),[m,q]=u.useState([]);u.useEffect(()=>{console.log(r),r.items&&h(r.items.map(s=>({id:s.product_variant_id,sku:s.product_variant.sku,quantity:s.quantity})))},[r]),u.useEffect(()=>{if(axios.get(route("stock_movements",{id:r.from_warehouse_id||r.to_warehouse_id})).then(s=>{console.log(s.data),q(s.data)}).catch(s=>{console.error("Error fetching data:",s)}),t==="transfer"&&c){const s=m.map(l=>l.product_variant);S(s)}else S(p)},[t,c,j]);const W=()=>{const s=i.map(l=>l.sku).filter(Boolean);return p.filter(l=>!s.includes(l.sku))},U=()=>{const s=i.map(d=>d.sku).filter(Boolean),l=m.map(d=>d.product_variant);return console.log(m),l.filter(d=>!s.includes(d.sku))},V=()=>{h([...i,{id:"",sku:"",quantity:""}])},E=s=>{h(i.filter((l,d)=>d!==s))},y=(s,l,d)=>{const o=i.map((a,n)=>n===s?{...a,[l]:d}:a);h(o)},C=(s,l,d)=>{const o=i.map((a,n)=>n===s?{...a,sku:l,id:d}:a);h(o),N(a=>({...a,[s]:!1}))},g=s=>{N(l=>({...l,[s]:!l[s]}))},K=s=>{s.preventDefault();const l={transaction_type:t,remarks:w,from_warehouse_id:t==="transfer"?c:null,to_warehouse_id:f,products:i.map(d=>({product_variant_id:d.id,quantity:d.quantity}))};x.put(`/inventory/stock/transactions/${r.id}`,l)},L=s=>{s.preventDefault(),x.post(`/inventory/stock/transactions/pending/${r.id}`)},P=s=>{s.preventDefault(),x.post(`/inventory/stock/transactions/approve/${r.id}`)},$=s=>{s.preventDefault(),x.post(`/inventory/stock/transactions/reject/${r.id}`)};return e.jsx(F,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Stock Transactions"}),children:e.jsx("div",{className:"py-12 flex justify-center",children:e.jsxs("div",{className:"w-full max-w-4xl bg-white shadow-lg rounded-lg p-8 border border-gray-200",children:[e.jsxs("div",{className:"flex w-full justify-between mb-6 border-b pb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Stock Transaction"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Transaction ID: #",r.id]})]}),e.jsxs("div",{className:"space-x-2",children:[(r==null?void 0:r.status)==="draft"&&e.jsx("button",{onClick:L,className:"bg-green-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Submit"}),(r==null?void 0:r.status)==="pending"&&e.jsx("button",{onClick:P,className:"bg-green-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Approved"}),(r==null?void 0:r.status)!="approved"&&(r==null?void 0:r.status)!="rejected"&&e.jsx("button",{onClick:$,className:"bg-red-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Reject"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 font-semibold",children:"Status:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:r.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 font-semibold",children:"Created At:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:new Date(r.created_at).toLocaleString()})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 font-bold",children:"Transaction Type:"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:t})]}),e.jsx("div",{className:"mb-6",children:t==="transfer"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Source Warehouse:"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",children:((T=b.find(s=>s.id===c))==null?void 0:T.name)||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Target Warehouse:"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",children:((R=b.find(s=>s.id===f))==null?void 0:R.name)||""})]})]}):e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Warehouse:"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",children:((A=b.find(s=>s.id===f))==null?void 0:A.name)||""})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 font-bold",children:"General Remarks:"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 transition",value:w,onChange:s=>D(s.target.value),disabled:(r==null?void 0:r.status)!=="draft"})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg h-[500px] overflow-y-auto mb-6 shadow-sm",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-3 text-gray-600",children:"Product SKU"}),t==="transfer"&&e.jsx("th",{className:"border px-4 py-3 text-gray-600",children:"Available Stock"}),e.jsx("th",{className:"border px-4 py-3 text-gray-600",children:"Quantity"}),e.jsx("th",{className:"border px-4 py-3 text-gray-600",hidden:(r==null?void 0:r.status)!=="draft",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:i.map((s,l)=>{var o;const d=((o=m.find(a=>a.product_variant_id===s.id))==null?void 0:o.total_stock)||0;return e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsxs("td",{className:"border px-4 py-2 relative",children:[t==="transfer"?e.jsx("input",{type:"text",className:"w-full border px-2 py-1 rounded",placeholder:"Search SKU (Transfer)",value:s.sku,onChange:a=>{y(l,"sku",a.target.value),g(l)},onFocus:()=>g(l)}):e.jsx("input",{type:"text",className:"w-full border px-2 py-1 rounded",placeholder:"Search SKU (Purchase)",value:s.sku,onChange:a=>{y(l,"sku",a.target.value),g(l)},onFocus:()=>g(l)}),t==="transfer"?v[l]&&e.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:U().map(a=>e.jsx("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>C(l,a.sku,a.id),children:a.sku},a.id))}):v[l]&&e.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:W().filter(a=>a.sku.toLowerCase().includes(s.sku.toLowerCase())).map(a=>e.jsx("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>C(l,a.sku,a.id),children:a.sku},a.id))})]}),t==="transfer"&&e.jsx("td",{className:"border px-4 py-2 text-center",children:d>0?e.jsxs("span",{className:"text-green-600 font-bold",children:[d," Available"]}):e.jsx("span",{className:"text-red-600 font-bold",children:"Out of Stock"})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("input",{type:"number",className:"border rounded px-3 py-1 w-full focus:ring-2 focus:ring-blue-400 transition",value:s.quantity,onChange:a=>{let n=parseInt(a.target.value,10)||0;t==="transfer"&&n>d&&(n=d),y(l,"quantity",n)},min:"1",max:t==="transfer"?d:"",disabled:(r==null?void 0:r.status)!=="draft"})}),e.jsx("td",{className:"border px-4 py-2",hidden:(r==null?void 0:r.status)!=="draft",children:e.jsx("button",{type:"button",onClick:()=>E(l),className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition",children:"Remove"})})]},l)})})]})}),e.jsx("div",{className:"flex justify-between items-center",children:(r==null?void 0:r.status)==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:V,className:"bg-blue-500 text-white px-5 py-2 rounded-lg shadow hover:bg-blue-600 transition",children:"Add Product"}),e.jsx("button",{onClick:K,className:"bg-green-500 text-white px-5 py-2 rounded-lg shadow hover:bg-green-600 transition",children:"Save Changes"})]})})]})})})};export{M as default};
