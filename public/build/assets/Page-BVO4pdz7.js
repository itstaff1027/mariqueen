import{a as M,r as _,j as t}from"./app-DsVvwk6J.js";import{A as Q}from"./AuthenticatedLayout-DB2dOl9d.js";import{I as u}from"./InputLabel-CrG5OC8W.js";import{I as c}from"./InputError-Z6W4Ksgv.js";import{J as V}from"./textarea-CGm_3-tZ.js";import"./ApplicationLogo-CDrwH3Pq.js";import"./description-v63VyX-U.js";import"./use-sync-refs-DNgf-CQf.js";const te=({stock_levels:j,colors:N,heel_heights:w,sizes:F,size_values:S,categories:I,user_warehouse:P,couriers:y,payment_methods:L,discounts:x,customers:b})=>{const{data:a,setData:n,post:q,errors:d}=M({cart:[],filters:{category:null,size:null,heelHeight:null,color:null,size_values:null},courier_id:"",payment_method_id:"",shipping_cost:0,rush_order_fee:"",payment_amount:0,total_amount:0,grand_total:0,discount_id:"",promotion_id:0,remarks:"",fixed_discount:0,customer_id:0}),[m,D]=_.useState(""),[p,C]=_.useState(""),[z,g]=_.useState(!1),k=()=>p?b.filter(e=>{const s=`${e.first_name} ${e.last_name}`.toLowerCase();return e.first_name.toLowerCase().includes(p.toLowerCase())||e.last_name.toLowerCase().includes(p.toLowerCase())||s.includes(p.toLowerCase())||e.id.toString().includes(p)}):b,A=e=>{const s=parseFloat(e.product_variant.discount_price)||parseFloat(e.product_variant.unit_price)||0,r=a.cart.findIndex(l=>l.sku===e.product_variant.sku);let o=[...a.cart];r!==-1?o[r].quantity<e.total_stock&&(o[r]={...o[r],discount_id:o[r].discount_id,discount_value:o[r].discount_value,quantity:o[r].quantity+1,subtotal:o[r].subtotal+s}):o.push({product_variant_id:e.product_variant.id,product_id:e.product_variant.product_id,sku:e.product_variant.sku,unit_price:e.product_variant.unit_price,discount_id:"",discount_value:0,promotion_id:0,quantity:1,total_stock:e.total_stock,subtotal:s}),n("cart",o)},$=e=>{const s=a.cart.map(r=>{if(r.sku===e&&r.quantity<r.total_stock){const o=r.quantity+1,l=parseFloat(r.discount_price)||parseFloat(r.unit_price);let i=0;return r.discount_id?i=l*(1-r.discount_value):i=l,{...r,quantity:o,subtotal:o*i}}return r});n("cart",s)},H=e=>{let s=a.cart.map(r=>{if(r.sku===e&&r.quantity>1){const o=r.quantity-1,l=parseFloat(r.discount_price)||parseFloat(r.unit_price);let i=0;return r.discount_id?i=l*(1-r.discount_value):i=l,{...r,quantity:o,subtotal:o*i}}return r});s=s.filter(r=>r.quantity>0),n("cart",s)},E=e=>{let s=a.cart.filter(r=>r.sku!==e);n("cart",s)},R=e=>{const s=x.find(r=>r.id==e);if(!s){console.error("Discount not found for id",e);return}if(a.discount_id!=e)if(s.type==="percentage"){const r=Number(s.value);let o=a.cart.map(l=>{const G=(parseFloat(l.discount_price)||parseFloat(l.unit_price)||0)*(1-r);return{...l,discount_id:e,discount_value:r,subtotal:G*l.quantity}});n("cart",o),n("discount_id",e)}else{const r=Number(s.value);n("fixed_discount",r);let o=a.cart.map(l=>{const i=parseFloat(l.discount_price)||parseFloat(l.unit_price)||0;return{...l,discount_id:e,discount_value:r,subtotal:i*l.quantity}});n("cart",o),n("discount_id",e)}else{let r=a.cart.map(o=>{const l=parseFloat(o.discount_price)||parseFloat(o.unit_price)||0;return{...o,discount_id:0,discount_value:0,subtotal:l*o.quantity}});n("cart",r),n("discount_id",0),n("fixed_discount",0)}},f=a.cart.reduce((e,s)=>e+s.subtotal,0),O=a.fixed_discount?a.fixed_discount:0,v=f+parseFloat(a.shipping_cost||0)+parseFloat(a.rush_order_fee||0)-O,h=a.payment_amount-v,T=j.filter(e=>{const s=(!a.filters.category||e.product_variant.category_id===parseInt(a.filters.category))&&(!a.filters.size||e.product_variant.size_id===parseInt(a.filters.size))&&(!a.filters.size_values||e.product_variant.size_value_id===parseInt(a.filters.size_values))&&(!a.filters.heelHeight||e.product_variant.heel_height_id===parseInt(a.filters.heelHeight))&&(!a.filters.color||e.product_variant.color_id===parseInt(a.filters.color)),r=m===""||e.product_variant.sku.toLowerCase().includes(m.toLowerCase())||e.product_variant.colors.color_name.toLowerCase().includes(m.toLowerCase())||e.product_variant.categories.category_name.toLowerCase().includes(m.toLowerCase());return s&&r}),U=e=>{e.preventDefault(),q("/point_of_sales"),console.log(a)};return _.useEffect(()=>{console.log(j),console.log(a.fixed_discount),n(e=>({...e,total_amount:f,grand_total:v}))},[a.cart,a.shipping_cost,a.rush_order_fee]),t.jsx(Q,{header:t.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Point of Sale - Warehouse: ",P]}),children:t.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4",children:[t.jsxs("div",{className:"col-span-3 mb-4 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5",children:[t.jsxs("select",{value:a.filters.category||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>n("filters",{...a.filters,category:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Categories"}),I.map(e=>t.jsx("option",{value:e.id,children:e.category_name},e.id))]}),t.jsxs("select",{value:a.filters.size||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>n("filters",{...a.filters,size:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Sizes"}),F.map(e=>t.jsx("option",{value:e.id,children:e.size_name},e.id))]}),t.jsxs("select",{value:a.filters.size_values||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>n("filters",{...a.filters,size_values:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"Size Values"}),S.map(e=>t.jsx("option",{value:e.id,children:e.size_values},e.id))]}),t.jsxs("select",{value:a.filters.heelHeight||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>n("filters",{...a.filters,heelHeight:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Heel Heights"}),w.map(e=>t.jsx("option",{value:e.id,children:e.value},e.id))]}),t.jsxs("select",{value:a.filters.color||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>n("filters",{...a.filters,color:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Colors"}),N.map(e=>t.jsx("option",{value:e.id,children:e.color_name},e.id))]})]}),t.jsxs("div",{className:"col-span-2 rounded-md border p-4 shadow-md",children:[t.jsx("input",{type:"text",placeholder:"Search for a product...",className:"w-full rounded-md border p-2",value:m,onChange:e=>D(e.target.value)}),t.jsx("div",{className:"mt-4 grid grid-cols-3 gap-4",children:T.map((e,s)=>t.jsxs("div",{className:"rounded-md border p-4",children:[t.jsxs("h3",{className:"text-lg font-semibold",children:["SKU: ",e.product_variant.sku]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Stock: ",e.total_stock]}),t.jsxs("p",{className:"mt-2 text-lg font-bold",children:["₱",e.product_variant.discount_price||e.product_variant.unit_price]}),t.jsx("button",{onClick:()=>A(e),className:"mt-2 rounded-md bg-blue-500 px-4 py-2 text-white",children:"Add to Cart"})]},s))})]}),t.jsxs("div",{className:"rounded-md border p-4 shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Cart"}),a.cart.length===0?t.jsx("p",{className:"text-gray-500",children:"No items in cart"}):t.jsx("div",{children:a.cart.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between border-b py-2",children:[t.jsxs("span",{children:[e.sku," (x",e.quantity,")"]}),t.jsxs("span",{children:["₱",parseFloat(e.subtotal||0).toFixed(2)]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:()=>H(e.sku),className:"mx-1 rounded-md bg-gray-300 px-2 py-1 text-gray-700",children:"-"}),t.jsx("button",{onClick:()=>$(e.sku),className:"mx-1 rounded-md bg-gray-300 px-2 py-1 text-gray-700",children:"+"}),t.jsx("button",{onClick:()=>E(e.sku),className:"ml-2 text-red-500",children:"Remove"})]})]},s))}),t.jsx(c,{message:d.cart}),t.jsxs("div",{className:"mt-4",children:[t.jsxs("p",{className:"text-lg font-bold",children:["Total: ₱",f.toFixed(2)]}),t.jsx("h1",{children:"KULANG NG FETCHING FOR PROMO, BUNDLES"}),t.jsx(u,{for:"customer",value:"Customer"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Search by ID, First or Last Name",className:"w-full rounded-md border p-2",value:p,onChange:e=>{C(e.target.value),g(!0)},onFocus:()=>g(!0)}),z&&t.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:k().map(e=>t.jsxs("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>{n("customer_id",e.id),C(`${e.first_name} ${e.last_name} (ID: ${e.id})`),g(!1)},children:[e.first_name," ",e.last_name," (ID: ",e.id,")"]},e.id))})]}),t.jsx(c,{message:d.customer_id}),t.jsx(u,{for:"courier",value:"Couriers"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:a.courier_id,onChange:e=>{const s=e.target.value;n("courier_id",s);const r=y.find(o=>o.id==s);r&&n("shipping_cost",r.fixed_shipping_cost)},children:[t.jsx("option",{value:"",children:"Select Courier"}),y.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(c,{message:d.courier_id}),a.courier_id&&t.jsxs(t.Fragment,{children:[t.jsx(u,{for:"shipping_cost",value:"Shipping Cost"}),t.jsx("input",{type:"number",placeholder:"Shipping Cost",className:"w-full rounded-md border p-2",value:a.shipping_cost,onChange:e=>n("shipping_cost",e.target.value)})]}),t.jsx(c,{message:d.shipping_cost}),t.jsx(u,{for:"payment_method",value:"Payment Method"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:a.payment_method_id,onChange:e=>n("payment_method_id",e.target.value),children:[t.jsx("option",{value:"",children:"Select Payment Method"}),L.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(c,{message:d.payment_method_id}),t.jsx(u,{for:"rush_order_fee",value:"Rush Cost"}),t.jsx("input",{type:"number",placeholder:"Rush Order Fee",className:"w-full rounded-md border p-2",value:a.rush_order_fee,onChange:e=>n("rush_order_fee",e.target.value)}),t.jsx(u,{for:"payment_amount",value:"Client Payment"}),t.jsx("input",{type:"number",placeholder:"Enter Payment Amount",className:"w-full rounded-md border p-2",value:a.payment_amount,onChange:e=>n("payment_amount",e.target.value)}),t.jsx(c,{message:d.payment_amount}),t.jsx(u,{for:"remarks",value:"Remarks/Note:"}),t.jsx(V,{className:"w-full",value:a.remarks,onChange:e=>n("remarks",e.target.value)}),t.jsx(c,{message:d.remarks}),x&&a.cart.length>0?x.map((e,s)=>t.jsx("button",{onClick:()=>R(e.id),className:`m-2 rounded-xl p-2 ${a.discount_id===e.id?"bg-yellow-700 text-white":"bg-yellow-400 hover:bg-yellow-700 hover:text-white"}`,children:e.name},s)):t.jsx("h1",{children:"No Discounts Available"}),t.jsxs("p",{className:"mt-2 text-lg font-bold",children:["Grand Total: ₱",v.toFixed(2)]}),t.jsx("p",{className:`mt-2 text-lg ${h<0?"text-red-500":"text-green-500"}`,children:h<0?`Balance Due: ₱${Math.abs(h).toFixed(2)}`:`Change: ₱${h.toFixed(2)}`}),t.jsx("button",{onClick:U,className:`${a.cart.length===0||a.courier_id===""||a.payment_method_id===""?"bg-green-700":"bg-green-500 "} mt-2 w-full rounded-md px-4 py-2 text-white`,disabled:a.cart.length===0||a.courier_id===""||a.payment_method_id==="",children:"Process Sale"})]})]})]})})};export{te as default};
