import{r as n,j as e,h as q}from"./app-B5iY72Ue.js";import{A as D}from"./AuthenticatedLayout-CFofA4XK.js";import"./ApplicationLogo-DtXMchGH.js";const L=({product_variants:b,warehouses:p,stock_levels:h})=>{const[o,u]=n.useState([]),[S,j]=n.useState({}),[l,k]=n.useState("purchase"),[c,g]=n.useState(""),[x,m]=n.useState("");n.useState("draft");const[y,w]=n.useState(""),[C,f]=n.useState(b);n.useEffect(()=>{if(console.log(h),l==="transfer"&&c){const a=h.filter(s=>s.to_warehouse_id.toString()===c.toString()).map(s=>s.product_variant);f(a)}else f(b)},[l,c,h]);const R=()=>{const a=o.map(s=>s.sku).filter(Boolean);return C.filter(s=>!a.includes(s.sku))},T=()=>{u([...o,{id:"",sku:"",quantity:""}])},_=a=>{u(o.filter((s,r)=>r!==a))},v=(a,s,r)=>{const i=o.map((t,d)=>d===a?{...t,[s]:r}:t);u(i)},W=(a,s,r)=>{const i=o.map((t,d)=>d===a?{...t,sku:s,id:r}:t);u(i),j(t=>({...t,[a]:!1}))},N=a=>{j(s=>({...s,[a]:!s[a]}))},A=a=>{k(a.target.value),g(""),m(""),u([])},V=a=>{a.preventDefault();const s={transaction_type:l,remarks:y,from_warehouse_id:l==="transfer"?c:null,to_warehouse_id:x,products:o.map(r=>({product_variant_id:r.id,quantity:r.quantity}))};console.log(s),q.post("/inventory/stock/transactions",s)};return e.jsx(D,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Stock Transactions"}),children:e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-md rounded-lg",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Stock Transactions"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded shadow hover:bg-green-600 mt-4",onClick:V,children:"Submit"}),e.jsx("button",{onClick:T,className:"bg-blue-500 text-white px-4 py-2 rounded shadow hover:bg-blue-600",children:"Add Row"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Transaction Type:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:l,onChange:A,children:[e.jsx("option",{value:"purchase",children:"Purchase"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"adjustment",children:"Adjustment"}),e.jsx("option",{value:"correction",children:"Correction"}),e.jsx("option",{value:"repair",children:"Repair"}),e.jsx("option",{value:"transfer",children:"Transfer"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"General Remarks:"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-4 py-2",placeholder:"Enter general remarks for this transaction",value:y,onChange:a=>w(a.target.value)})]}),l==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Source Warehouse:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:c,onChange:a=>g(a.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Source Warehouse"}),p.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Target Warehouse:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:x,onChange:a=>m(a.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Target Warehouse"}),p.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}):e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Warehouse:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:x,onChange:a=>m(a.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Warehouse"}),p.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("table",{className:"w-full table-auto border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border px-4 py-2",children:"Product SKU"}),e.jsx("th",{className:"border px-4 py-2",hidden:l!=="transfer",children:"Available Stocks"}),e.jsx("th",{className:"border px-4 py-2",children:"Quantity"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:o.map((a,s)=>{var i;const r=((i=h.find(t=>t.product_variant_id===a.id&&t.to_warehouse_id.toString()===c.toString()))==null?void 0:i.total_stock)||0;return e.jsxs("tr",{children:[e.jsxs("td",{className:"border px-4 py-2 relative",children:[e.jsx("input",{type:"text",className:"w-full border px-2 py-1 rounded",placeholder:"Search SKU",value:a.sku,onChange:t=>{v(s,"sku",t.target.value),N(s)},onFocus:()=>N(s)}),S[s]&&e.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:R().filter(t=>t.sku.toLowerCase().includes(a.sku.toLowerCase())).map(t=>e.jsx("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>W(s,t.sku,t.id),children:t.sku},t.id))})]}),l==="transfer"&&e.jsx("td",{className:"border px-4 py-2 text-center",children:r>0?e.jsxs("span",{className:"text-green-600 font-bold",children:[r," Available"]}):e.jsx("span",{className:"text-red-600 font-bold",children:"Out of Stock"})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("input",{type:"number",className:"w-full border px-2 py-1 rounded",placeholder:"Enter Quantity",value:a.quantity,onChange:t=>{let d=parseInt(t.target.value,10)||0;l==="transfer"&&d>r&&(d=r),v(s,"quantity",d)},min:"1",max:l==="transfer"?r:"",disabled:l==="transfer"&&r===0})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("button",{type:"button",onClick:()=>_(s),className:"bg-red-500 text-white px-2 py-1 rounded shadow hover:bg-red-600",children:"Remove"})})]},s)})})]})]})})})})})})};export{L as default};
