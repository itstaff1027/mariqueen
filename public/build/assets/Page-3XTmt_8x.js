import{j as t,r as d,a as ae,U as le}from"./app-DzVPnBm_.js";import{A as re}from"./AuthenticatedLayout-CM951Vbx.js";import{I as p}from"./InputLabel-CVOs2is0.js";import{I as _}from"./InputError-W5ybVOTN.js";import{J as oe}from"./textarea-C9AA6iOp.js";import"./ApplicationLogo-1LC3dhoW.js";import"./useFocusRing-CbgUoASV.js";import"./description-DvabQjNZ.js";import"./use-sync-refs-mp_AuGG8.js";const ne=({onClose:h,children:b})=>t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-[rgba(0,0,0,0.5)]",onClick:()=>h(!1),children:t.jsxs("div",{className:"relative w-1/3 rounded bg-white p-6 shadow-lg",onClick:f=>f.stopPropagation(),children:[t.jsx("button",{className:"absolute right-4 top-4 text-gray-500 hover:text-gray-800",onClick:()=>h(!1),children:"✕"}),t.jsx("h1",{className:"text-xl font-semibold mb-4",children:"Promotion (Bundle/BOGO)"}),b]})}),ie=({filters:h,onFilterChange:b,search:f,onSearchChange:w,colors:k,sizes:P,heelHeights:z,sizeValues:F,categories:D})=>{const[j,C]=d.useState(f),[i,x]=d.useState(h);return d.useEffect(()=>{C(f)},[f]),d.useEffect(()=>{x(h)},[h]),d.useEffect(()=>{const s=setTimeout(()=>{w(j)},300);return()=>clearTimeout(s)},[j,w]),d.useEffect(()=>{const s=setTimeout(()=>{b(i)},300);return()=>clearTimeout(s)},[i,b]),t.jsxs("div",{className:"col-span-3 mb-4 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5",children:[t.jsxs("select",{value:i.category||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:s=>x({...i,category:s.target.value||null}),children:[t.jsx("option",{value:"",children:"All Categories"}),D.map(s=>t.jsx("option",{value:s.category_name,children:s.category_name},s.id))]}),t.jsxs("select",{value:i.size||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:s=>x({...i,size:s.target.value||null}),children:[t.jsx("option",{value:"",children:"All Sizes"}),P.map(s=>t.jsx("option",{value:s.size_name,children:s.size_name},s.id))]}),t.jsxs("select",{value:i.size_values||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:s=>x({...i,size_values:s.target.value||null}),children:[t.jsx("option",{value:"",children:"Size Values"}),F.map(s=>t.jsx("option",{value:s.size_values,children:s.size_values},s.id))]}),t.jsxs("select",{value:i.heelHeight||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:s=>x({...i,heelHeight:s.target.value||null}),children:[t.jsx("option",{value:"",children:"All Heel Heights"}),z.map(s=>t.jsx("option",{value:s.value,children:s.value},s.id))]}),t.jsxs("select",{value:i.color||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:s=>x({...i,color:s.target.value||null}),children:[t.jsx("option",{value:"",children:"All Colors"}),k.map(s=>t.jsx("option",{value:s.color_name,children:s.color_name},s.id))]}),t.jsx("input",{type:"text",placeholder:"Search for a product...",className:"w-full rounded-md border p-2 shadow-sm focus:outline-none",value:j,onChange:s=>C(s.target.value)})]})},fe=({stock_lvls:h,colors:b,heel_heights:f,sizes:w,size_values:k,categories:P,user_warehouse:z,couriers:F,payment_methods:D,discounts:j,customers:C,packaging_types:i,stock_levels:x})=>{const{data:s,setData:n,post:B,errors:m}=ae({cart:[],filters:{category:null,size:null,heelHeight:null,color:null,size_values:null},courier_id:"",payment_method_id:"",shipping_cost:0,rush_order_fee:"",payment_amount:0,total_amount:0,grand_total:0,discount_id:"",promotion_id:0,remarks:"",fixed_discount:0,customer_id:0,packaging_type_id:"",shoulder_by:"bragais",images:[]}),[y,R]=d.useState(""),[u,O]=d.useState({}),[N,E]=d.useState(""),[Q,L]=d.useState(!1),[q,$]=d.useState([]),[V,H]=d.useState(!1),G=d.useMemo(()=>x.data.filter(e=>{const a=(!u.category||e.category===u.category)&&(!u.size||e.size_name===u.size)&&(!u.size_values||e.size_value===u.size_values)&&(!u.heelHeight||e.heel_height===u.heelHeight)&&(!u.color||e.color_name===u.color),r=y===""||e.product_sku.toLowerCase().includes(y.toLowerCase())||e.color_name.toLowerCase().includes(y.toLowerCase())||e.category.toLowerCase().includes(y.toLowerCase());return a&&r}),[h,u,y]),U=()=>{H(!0)},J=()=>N?C.filter(e=>{const a=`${e.first_name} ${e.last_name}`.toLowerCase();return e.first_name.toLowerCase().includes(N.toLowerCase())||e.last_name.toLowerCase().includes(N.toLowerCase())||a.includes(N.toLowerCase())||e.id.toString().includes(N)}):C,A=e=>{console.log(e);const a=e.discount_price!=null?parseFloat(e.discount_price):null,r=parseFloat(e.unit_price)||0,l=a!==null?a:r,o=s.cart.findIndex(g=>g.sku===e.product_sku&&g.price===l),c=s.cart.reduce((g,M)=>M.sku===e.product_sku?g+M.quantity:g,0),v=[...s.cart];if(o>-1){const g=v[o];c<e.total_stock&&(g.quantity++,g.subtotal+=l)}else c<e.total_stock&&v.push({sku:e.product_sku,product_id:e.product_id,product_variant_id:e.product_variant_id,unit_price:r,discount_price:a,price:l,quantity:1,total_stock:e.total_stock,subtotal:l,promotion_id:e.promotion_id?e.promotion_id:null});n("cart",v)},W=(e,a)=>{const r=s.cart.reduce((o,c)=>c.sku===e?o+c.quantity:o,0),l=s.cart.map(o=>{if(o.sku===e&&o.promotion_id===a){if(r>=o.total_stock)return o;const c=o.quantity+1,v=parseFloat(o.discount_price??o.unit_price)||0;return{...o,quantity:c,subtotal:c*v}}return o});n("cart",l)},K=(e,a)=>{s.cart.reduce((l,o)=>o.sku===e?l+o.quantity:l,0);let r=s.cart.map(l=>{if(l.sku===e&&l.quantity>1){const o=l.quantity-1,c=parseFloat(l.discount_price??l.unit_price)||0;return{...l,quantity:o,subtotal:o*c}}return l});n("cart",r)},X=(e,a)=>{n("cart",s.cart.filter(r=>r.sku!==e||r.promotion_id!==a))},Y=e=>{const a=j.find(r=>r.id==e);if(!a){n("discount_id",0),n("fixed_discount",0),console.error("Discount not found for id",e);return}if(s.discount_id!=e)if(a.type==="percentage"){const r=Number(a.value);let l=s.cart.map(o=>{const v=(parseFloat(o.discount_price)||parseFloat(o.unit_price)||0)*(1-r);return{...o,discount_id:e,discount_value:r,subtotal:v*o.quantity}});n("cart",l),n("discount_id",e)}else{const r=Number(a.value);n("fixed_discount",r);let l=s.cart.map(o=>{const c=parseFloat(o.discount_price)||parseFloat(o.unit_price)||0;return{...o,discount_id:e,discount_value:r,subtotal:c*o.quantity}});n("cart",l),n("discount_id",e)}else{let r=s.cart.map(l=>{const o=parseFloat(l.discount_price)||parseFloat(l.unit_price)||0;return{...l,discount_id:0,discount_value:0,subtotal:o*l.quantity}});n("cart",r),n("discount_id",0),n("fixed_discount",0)}},I=s.cart.reduce((e,a)=>e+a.subtotal,0),Z=s.fixed_discount?s.fixed_discount:0,T=I+parseFloat(s.shipping_cost||0)+parseFloat(s.rush_order_fee||0)-Z,S=s.payment_amount-T,ee=e=>{e.preventDefault();const a=new FormData;for(let r=0;r<s.images.length;r++)a.append("images[]",s.images[r]);B("/point_of_sales",{data:a,forceFormData:!0}),console.log(s)},te=e=>{const a=Array.from(e.target.files);n("images",a),$(a)},se=e=>{const a=q.filter((r,l)=>l!==e);$(a),n("images",a)};return d.useEffect(()=>{console.log(s.cart),n(e=>({...e,total_amount:I,grand_total:T}))},[s.cart,s.shipping_cost,s.rush_order_fee]),t.jsxs(re,{header:t.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Point of Sale - Warehouse: ",z]}),children:[t.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4",children:[t.jsx(ie,{filters:u,onFilterChange:O,search:y,onSearchChange:R,colors:b,sizes:w,heelHeights:f,sizeValues:k,categories:P}),t.jsxs("div",{className:"col-span-2 rounded-md border p-4 shadow-md",children:[t.jsx("div",{className:"py-4 w-full",children:t.jsxs("div",{className:"space-x-4",children:[t.jsx(le,{href:"/customers/create",className:"bg-blue-500 text-white px-4 py-2 rounded shadow hover:bg-blue-600",children:"New Customer"}),t.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded shadow hover:bg-blue-600",onClick:()=>U(),children:"Bundle/BOGO Modal"})]})}),t.jsx("div",{className:"mt-4 grid grid-cols-3 gap-4",children:G.map((e,a)=>{var r;return t.jsxs("div",{className:"w-full flex flex-col rounded-md border p-4",children:[t.jsxs("div",{className:"flex w-full",children:[t.jsx("div",{className:"w-1/2 border",children:t.jsx("img",{src:"",alt:"text",className:"w-full h-1/2 border"})}),t.jsxs("div",{className:"w-1/2 text-right",children:[t.jsx("h3",{className:"text-lg font-semibold",children:t.jsx("u",{children:e.product_sku})}),t.jsx("h3",{className:"text-lg font-semibold",children:t.jsx("u",{children:e.product_name})}),t.jsx("h3",{className:"text-lg font-semibold",children:t.jsx("u",{children:e.color_name})}),t.jsxs("h3",{className:"text-lg font-semibold",children:["S: ",t.jsx("u",{children:e.size_value})]}),t.jsxs("h3",{className:"text-lg font-semibold",children:["IN: ",t.jsx("u",{children:e.heel_height})]})]})]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Stock Left - ",t.jsxs("u",{children:[" ",e.total_stock]})]}),t.jsxs("p",{className:"mt-2 text-lg font-bold",children:["₱",e.unit_price]}),e.promotions.length>0?t.jsxs("select",{children:[t.jsx("option",{onClick:()=>A(e),children:"Add as SRP"}),(r=e.promotions)==null?void 0:r.map(l=>t.jsx("option",{onClick:()=>A({...e,discount_price:l.type=="discount"?parseFloat(e.unit_price)*(1-parseFloat(l.discount_value)):0,promotion_id:l.id}),children:l.name},l.id))]}):t.jsx("button",{onClick:()=>A(e),className:"mt-2 rounded-md bg-blue-500 px-4 py-2 text-white",children:"Add"})]},a)})})]}),t.jsxs("div",{className:"rounded-md border p-4 shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Cart"}),s.cart.length===0?t.jsx("p",{className:"text-gray-500",children:"No items in cart"}):t.jsx("div",{children:s.cart.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between border-b py-2",children:[t.jsxs("span",{children:[e.sku," (x",e.quantity,")"]}),t.jsxs("span",{children:["₱",parseFloat(e.subtotal||0).toFixed(2)]}),t.jsxs("div",{className:"flex items-center",children:[e.quantity!==1&&t.jsx("button",{onClick:()=>K(e.sku),className:"mx-1 rounded-md bg-gray-300 px-2 py-1 text-gray-700",children:"-"}),t.jsx("button",{onClick:()=>W(e.sku,e.promotion_id),className:"mx-1 rounded-md bg-gray-300 px-2 py-1 text-gray-700",children:"+"}),t.jsx("button",{onClick:()=>X(e.sku,e.promotion_id),className:"ml-2 text-red-500",children:"Remove"})]})]},a))}),t.jsx(_,{message:m.cart}),t.jsxs("div",{className:"mt-4",children:[t.jsxs("p",{className:"text-lg font-bold",children:["Total: ₱",I.toFixed(2)]}),t.jsx(p,{for:"customer",value:"Customer"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Search by ID, First or Last Name",className:"w-full rounded-md border p-2",value:N,onChange:e=>{E(e.target.value),L(!0)},onFocus:()=>L(!0)}),Q&&t.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:J().map(e=>t.jsxs("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>{n("customer_id",e.id),E(`${e.first_name} ${e.last_name} (ID: ${e.id})`),L(!1)},children:[e.first_name," ",e.last_name," (ID: ",e.id,")"]},e.id))})]}),t.jsx(_,{message:m.customer_id}),t.jsx(p,{for:"courier",value:"Couriers"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:s.courier_id,onChange:e=>{const a=e.target.value;n("courier_id",a);const r=F.find(l=>l.id==a);r&&n("shipping_cost",r.fixed_shipping_cost)},children:[t.jsx("option",{value:"",children:"Select Courier"}),F.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(_,{message:m.courier_id}),s.courier_id&&t.jsxs(t.Fragment,{children:[t.jsx(p,{for:"shipping_cost",value:"Shipping Cost"}),t.jsx("input",{type:"number",placeholder:"Shipping Cost",className:"w-full rounded-md border p-2",value:s.shipping_cost,onChange:e=>n("shipping_cost",e.target.value)}),t.jsx(p,{for:"shoulder_by",value:"Shoulder By"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:s.shoulder_by,onChange:e=>n("shoulder_by",e.target.value),children:[t.jsx("option",{value:"bragais",children:"Bragais"}),t.jsx("option",{value:"client",children:"Client"})]})]}),t.jsx(_,{message:m.shipping_cost}),t.jsx(p,{for:"packaging_type_id",value:"Packaging Type"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:s.packaging_type_id,onChange:e=>n("packaging_type_id",e.target.value),children:[t.jsx("option",{value:"",children:"Select Packaging Type"}),i.map(e=>t.jsx("option",{value:e.id,children:e.packaging_name},e.id))]}),t.jsx(_,{message:m.packaging_type_id}),t.jsx(p,{for:"payment_method",value:"Payment Method"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:s.payment_method_id,onChange:e=>n("payment_method_id",e.target.value),children:[t.jsx("option",{value:"",children:"Select Payment Method"}),D.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(_,{message:m.payment_method_id}),t.jsx(p,{for:"rush_order_fee",value:"Rush Cost"}),t.jsx("input",{type:"number",placeholder:"Rush Order Fee",className:"w-full rounded-md border p-2",value:s.rush_order_fee,onChange:e=>n("rush_order_fee",e.target.value)}),t.jsx(p,{for:"payment_amount",value:"Client Payment"}),t.jsx("input",{type:"number",placeholder:"Enter Payment Amount",className:"w-full rounded-md border p-2",value:s.payment_amount,onChange:e=>n("payment_amount",e.target.value)}),t.jsx(_,{message:m.payment_amount}),t.jsx(p,{for:"remarks",value:"Remarks/Note:"}),t.jsx(oe,{className:"w-full",value:s.remarks,onChange:e=>n("remarks",e.target.value)}),t.jsx(_,{message:m.remarks}),j&&s.cart.length>0&&t.jsxs("div",{className:"py-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Apply Discount (Toggle the selected Discount to remove the discount)"}),t.jsxs("select",{className:"mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:s.discount_id,children:[t.jsx("option",{value:"0",children:"- No Discount -"}),j.map((e,a)=>t.jsx("option",{onClick:r=>Y(e.id),value:e.id,children:e.name},a))]})]}),t.jsxs("p",{className:"mt-2 text-lg font-bold",children:["Grand Total: ₱",T.toFixed(2)]}),t.jsx("p",{className:`mt-2 text-lg ${S<0?"text-red-500":"text-green-500"}`,children:S<0?`Balance Due: ₱${Math.abs(S).toFixed(2)}`:`Change: ₱${S.toFixed(2)}`}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Upload Payment Images (Multiple Allowed)"}),t.jsx("input",{type:"file",name:"new_images",multiple:!0,onChange:te,className:"border p-2 rounded"}),m.new_images&&t.jsx("div",{className:"text-red-500 mt-2",children:m.new_images}),q.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h2",{className:"text-lg font-bold",children:"Selected Files:"}),t.jsx("ul",{className:"list-disc list-inside",children:q.map((e,a)=>t.jsxs("li",{className:"text-gray-700 flex items-center justify-between",children:[e.name,t.jsx("button",{type:"button",onClick:()=>se(a),className:"text-red-500 ml-2",children:"Remove"})]},a))})]})]}),t.jsx("button",{onClick:ee,className:`${s.cart.length===0||s.courier_id===""||s.payment_method_id===""?"bg-green-700":"bg-green-500 "} mt-2 w-full rounded-md px-4 py-2 text-white`,disabled:s.cart.length===0||s.courier_id===""||s.payment_method_id==="",children:"Process Sale"})]})]})]}),V&&t.jsx(ne,{onClose:e=>H(e)})]})};export{fe as default};
