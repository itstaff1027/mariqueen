import{r as i,j as e,h as C}from"./app-B5iY72Ue.js";import{A as R}from"./AuthenticatedLayout-CFofA4XK.js";import"./ApplicationLogo-DtXMchGH.js";const T=({product_variants:K,warehouses:g,stock_levels:u})=>{const[o,h]=i.useState([]),[f,m]=i.useState({}),[x,y]=i.useState(""),[l,S]=i.useState(""),[U,p]=i.useState([]);i.useEffect(()=>{if(console.log(u),l){const t=u.filter(r=>r.to_warehouse_id.toString()===l.toString());p(t)}},[l,u]);const j=()=>{h([...o,{id:"",sku:"",quantity:0,remarks:""}]),p(c())},v=t=>{h(o.filter((r,a)=>a!==t))},b=(t,r,a)=>{const n=o.map((s,d)=>d===t?{...s,[r]:a}:s);h(n)},N=(t,r)=>{b(t,"sku",r),p(c()),m(a=>({...a,[t]:!0}))},k=(t,r,a)=>{const n=o.map((s,d)=>d===t?{...s,sku:r,id:a}:s);h(n),p(c()),m(s=>({...s,[t]:!1}))},c=()=>{const t=o.map(r=>r.sku).filter(Boolean);return u.filter(r=>r.to_warehouse_id.toString()===l.toString()&&!t.includes(r.product_variant.sku))},_=t=>{y(t)},w=t=>{S(t)},W=t=>{if(t.preventDefault(),!x||!l){alert("Please select both Source and Destination Warehouses!");return}const r=o.map(a=>{if(!a.sku||!a.id)return alert("All rows must have a valid SKU selected!"),null;if(a.quantity<=0)return alert(`Quantity for SKU ${a.sku} must be greater than 0!`),null;const n=u.find(d=>d.product_variant_id===a.id&&d.to_warehouse_id.toString()===l.toString()),s=n?n.total_stock:0;return s<a.quantity?(alert(`Not enough stock in Source Warehouse for SKU ${a.sku}. Available: ${s}`),null):{id:a.id,sku:a.sku,quantity:a.quantity,remarks:a.remarks,from_warehouse_id:l,to_warehouse_id:x}}).filter(Boolean);if(r.length===0){alert("No valid transfers to process!");return}console.log("Submitting Transfer:",r),C.post("/inventory/store/stock/transfer",{transfers:r})};return e.jsx(R,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Stock Transfer"}),children:e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-md rounded-lg h-[1000px]",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Stock Transfer"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Source Warehouse:"}),e.jsxs("select",{className:"w-full border rounded px-4 py-2",value:l,onChange:t=>w(t.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Source Warehouse"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Destination Warehouse:"}),e.jsxs("select",{className:"w-full border rounded px-4 py-2",value:x,onChange:t=>_(t.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Destination Warehouse"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("button",{onClick:j,className:"bg-blue-500 text-white px-4 py-2 rounded shadow hover:bg-blue-600 mb-4",children:"Add Row"}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("table",{className:"w-full table-auto border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border px-4 py-2",children:"Product SKU"}),e.jsx("th",{className:"border px-4 py-2",children:"Quantity"}),e.jsx("th",{className:"border px-4 py-2",children:"Remarks"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:o.map((t,r)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"border px-4 py-2 relative",children:[e.jsx("input",{type:"text",className:"w-full border rounded px-2 py-1",placeholder:"Search SKU",value:t.sku,onChange:a=>N(r,a.target.value),onFocus:()=>m(a=>({...a,[r]:!0}))}),f[r]&&c().length>0&&e.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:c().map((a,n)=>e.jsxs("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>k(r,a.product_variant.sku,a.product_variant_id),children:[a.product_variant.sku," (Available: ",a.total_stock,")"]},`${a.product_variant_id}-${n}`))})]}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1",value:t.quantity,onChange:a=>b(r,"quantity",a.target.value)})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("input",{type:"text",className:"w-full border rounded px-2 py-1",value:t.remarks,onChange:a=>b(r,"remarks",a.target.value)})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("button",{type:"button",onClick:()=>v(r),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"Remove"})})]},r))})]}),e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 mt-4",children:"Submit Transfer"})]})]})})})})})};export{T as default};
