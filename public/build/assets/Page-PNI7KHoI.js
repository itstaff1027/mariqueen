import{a as B,r as h,j as t}from"./app-B9zs1XDa.js";import{A as K}from"./AuthenticatedLayout-BVBNPDOM.js";import{I as c}from"./InputLabel-4lFzUnns.js";import{I as u}from"./InputError-Csi0-QeO.js";import{J}from"./textarea-DbQo477F.js";import"./ApplicationLogo-Dhb1On_J.js";import"./description-ZVIRoeJY.js";import"./use-sync-refs-BtUJTuk1.js";const re=({stock_levels:j,colors:w,heel_heights:F,sizes:S,size_values:I,categories:P,user_warehouse:D,couriers:y,payment_methods:L,discounts:x,customers:b})=>{const{data:a,setData:l,post:q,errors:d}=B({cart:[],filters:{category:null,size:null,heelHeight:null,color:null,size_values:null},courier_id:"",payment_method_id:"",shipping_cost:0,rush_order_fee:"",payment_amount:0,total_amount:0,grand_total:0,discount_id:"",promotion_id:0,remarks:"",fixed_discount:0,customer_id:0,images:[]}),[m,z]=h.useState(""),[p,C]=h.useState(""),[A,g]=h.useState(!1),[N,k]=h.useState([]),$=()=>p?b.filter(e=>{const r=`${e.first_name} ${e.last_name}`.toLowerCase();return e.first_name.toLowerCase().includes(p.toLowerCase())||e.last_name.toLowerCase().includes(p.toLowerCase())||r.includes(p.toLowerCase())||e.id.toString().includes(p)}):b,H=e=>{const r=parseFloat(e.product_variant.discount_price)||parseFloat(e.product_variant.unit_price)||0,s=a.cart.findIndex(o=>o.sku===e.product_variant.sku);let n=[...a.cart];s!==-1?n[s].quantity<e.total_stock&&(n[s]={...n[s],discount_id:n[s].discount_id,discount_value:n[s].discount_value,quantity:n[s].quantity+1,subtotal:n[s].subtotal+r}):n.push({product_variant_id:e.product_variant.id,product_id:e.product_variant.product_id,sku:e.product_variant.sku,unit_price:e.product_variant.unit_price,discount_id:"",discount_value:0,promotion_id:0,quantity:1,total_stock:e.total_stock,subtotal:r}),l("cart",n)},E=e=>{const r=a.cart.map(s=>{if(s.sku===e&&s.quantity<s.total_stock){const n=s.quantity+1,o=parseFloat(s.discount_price)||parseFloat(s.unit_price);let i=0;return s.discount_id?i=o*(1-s.discount_value):i=o,{...s,quantity:n,subtotal:n*i}}return s});l("cart",r)},R=e=>{let r=a.cart.map(s=>{if(s.sku===e&&s.quantity>1){const n=s.quantity-1,o=parseFloat(s.discount_price)||parseFloat(s.unit_price);let i=0;return s.discount_id?i=o*(1-s.discount_value):i=o,{...s,quantity:n,subtotal:n*i}}return s});r=r.filter(s=>s.quantity>0),l("cart",r)},U=e=>{let r=a.cart.filter(s=>s.sku!==e);l("cart",r)},M=e=>{const r=x.find(s=>s.id==e);if(!r){console.error("Discount not found for id",e);return}if(a.discount_id!=e)if(r.type==="percentage"){const s=Number(r.value);let n=a.cart.map(o=>{const V=(parseFloat(o.discount_price)||parseFloat(o.unit_price)||0)*(1-s);return{...o,discount_id:e,discount_value:s,subtotal:V*o.quantity}});l("cart",n),l("discount_id",e)}else{const s=Number(r.value);l("fixed_discount",s);let n=a.cart.map(o=>{const i=parseFloat(o.discount_price)||parseFloat(o.unit_price)||0;return{...o,discount_id:e,discount_value:s,subtotal:i*o.quantity}});l("cart",n),l("discount_id",e)}else{let s=a.cart.map(n=>{const o=parseFloat(n.discount_price)||parseFloat(n.unit_price)||0;return{...n,discount_id:0,discount_value:0,subtotal:o*n.quantity}});l("cart",s),l("discount_id",0),l("fixed_discount",0)}},f=a.cart.reduce((e,r)=>e+r.subtotal,0),O=a.fixed_discount?a.fixed_discount:0,v=f+parseFloat(a.shipping_cost||0)+parseFloat(a.rush_order_fee||0)-O,_=a.payment_amount-v,T=j.filter(e=>{const r=(!a.filters.category||e.product_variant.category_id===parseInt(a.filters.category))&&(!a.filters.size||e.product_variant.size_id===parseInt(a.filters.size))&&(!a.filters.size_values||e.product_variant.size_value_id===parseInt(a.filters.size_values))&&(!a.filters.heelHeight||e.product_variant.heel_height_id===parseInt(a.filters.heelHeight))&&(!a.filters.color||e.product_variant.color_id===parseInt(a.filters.color)),s=m===""||e.product_variant.sku.toLowerCase().includes(m.toLowerCase())||e.product_variant.colors.color_name.toLowerCase().includes(m.toLowerCase())||e.product_variant.categories.category_name.toLowerCase().includes(m.toLowerCase());return r&&s}),G=e=>{e.preventDefault();const r=new FormData;for(let s=0;s<a.images.length;s++)r.append("images[]",a.images[s]);q("/point_of_sales",{data:r,forceFormData:!0}),console.log(a)},Q=e=>{const r=Array.from(e.target.files);l("images",r),k(r)};return h.useEffect(()=>{console.log(j),console.log(a.fixed_discount),l(e=>({...e,total_amount:f,grand_total:v}))},[a.cart,a.shipping_cost,a.rush_order_fee]),t.jsx(K,{header:t.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Point of Sale - Warehouse: ",D]}),children:t.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4",children:[t.jsxs("div",{className:"col-span-3 mb-4 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5",children:[t.jsxs("select",{value:a.filters.category||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>l("filters",{...a.filters,category:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Categories"}),P.map(e=>t.jsx("option",{value:e.id,children:e.category_name},e.id))]}),t.jsxs("select",{value:a.filters.size||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>l("filters",{...a.filters,size:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Sizes"}),S.map(e=>t.jsx("option",{value:e.id,children:e.size_name},e.id))]}),t.jsxs("select",{value:a.filters.size_values||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>l("filters",{...a.filters,size_values:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"Size Values"}),I.map(e=>t.jsx("option",{value:e.id,children:e.size_values},e.id))]}),t.jsxs("select",{value:a.filters.heelHeight||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>l("filters",{...a.filters,heelHeight:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Heel Heights"}),F.map(e=>t.jsx("option",{value:e.id,children:e.value},e.id))]}),t.jsxs("select",{value:a.filters.color||"",className:"rounded-md border p-2 shadow-sm focus:outline-none",onChange:e=>l("filters",{...a.filters,color:e.target.value?parseInt(e.target.value):null}),children:[t.jsx("option",{value:"",children:"All Colors"}),w.map(e=>t.jsx("option",{value:e.id,children:e.color_name},e.id))]})]}),t.jsxs("div",{className:"col-span-2 rounded-md border p-4 shadow-md",children:[t.jsx("input",{type:"text",placeholder:"Search for a product...",className:"w-full rounded-md border p-2",value:m,onChange:e=>z(e.target.value)}),t.jsx("div",{className:"mt-4 grid grid-cols-3 gap-4",children:T.map((e,r)=>t.jsxs("div",{className:"rounded-md border p-4",children:[t.jsxs("h3",{className:"text-lg font-semibold",children:["SKU: ",e.product_variant.sku]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Stock: ",e.total_stock]}),t.jsxs("p",{className:"mt-2 text-lg font-bold",children:["₱",e.product_variant.discount_price||e.product_variant.unit_price]}),t.jsx("button",{onClick:()=>H(e),className:"mt-2 rounded-md bg-blue-500 px-4 py-2 text-white",children:"Add to Cart"})]},r))})]}),t.jsxs("div",{className:"rounded-md border p-4 shadow-md",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Cart"}),a.cart.length===0?t.jsx("p",{className:"text-gray-500",children:"No items in cart"}):t.jsx("div",{children:a.cart.map((e,r)=>t.jsxs("div",{className:"flex items-center justify-between border-b py-2",children:[t.jsxs("span",{children:[e.sku," (x",e.quantity,")"]}),t.jsxs("span",{children:["₱",parseFloat(e.subtotal||0).toFixed(2)]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:()=>R(e.sku),className:"mx-1 rounded-md bg-gray-300 px-2 py-1 text-gray-700",children:"-"}),t.jsx("button",{onClick:()=>E(e.sku),className:"mx-1 rounded-md bg-gray-300 px-2 py-1 text-gray-700",children:"+"}),t.jsx("button",{onClick:()=>U(e.sku),className:"ml-2 text-red-500",children:"Remove"})]})]},r))}),t.jsx(u,{message:d.cart}),t.jsxs("div",{className:"mt-4",children:[t.jsxs("p",{className:"text-lg font-bold",children:["Total: ₱",f.toFixed(2)]}),t.jsx("h1",{children:"KULANG NG FETCHING FOR PROMO, BUNDLES"}),t.jsx(c,{for:"customer",value:"Customer"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Search by ID, First or Last Name",className:"w-full rounded-md border p-2",value:p,onChange:e=>{C(e.target.value),g(!0)},onFocus:()=>g(!0)}),A&&t.jsx("ul",{className:"absolute z-10 bg-white border rounded w-full max-h-40 overflow-y-auto",children:$().map(e=>t.jsxs("li",{className:"px-4 py-2 hover:bg-gray-200 cursor-pointer",onClick:()=>{l("customer_id",e.id),C(`${e.first_name} ${e.last_name} (ID: ${e.id})`),g(!1)},children:[e.first_name," ",e.last_name," (ID: ",e.id,")"]},e.id))})]}),t.jsx(u,{message:d.customer_id}),t.jsx(c,{for:"courier",value:"Couriers"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:a.courier_id,onChange:e=>{const r=e.target.value;l("courier_id",r);const s=y.find(n=>n.id==r);s&&l("shipping_cost",s.fixed_shipping_cost)},children:[t.jsx("option",{value:"",children:"Select Courier"}),y.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(u,{message:d.courier_id}),a.courier_id&&t.jsxs(t.Fragment,{children:[t.jsx(c,{for:"shipping_cost",value:"Shipping Cost"}),t.jsx("input",{type:"number",placeholder:"Shipping Cost",className:"w-full rounded-md border p-2",value:a.shipping_cost,onChange:e=>l("shipping_cost",e.target.value)})]}),t.jsx(u,{message:d.shipping_cost}),t.jsx(c,{for:"payment_method",value:"Payment Method"}),t.jsxs("select",{className:"w-full rounded-md border p-2",value:a.payment_method_id,onChange:e=>l("payment_method_id",e.target.value),children:[t.jsx("option",{value:"",children:"Select Payment Method"}),L.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(u,{message:d.payment_method_id}),t.jsx(c,{for:"rush_order_fee",value:"Rush Cost"}),t.jsx("input",{type:"number",placeholder:"Rush Order Fee",className:"w-full rounded-md border p-2",value:a.rush_order_fee,onChange:e=>l("rush_order_fee",e.target.value)}),t.jsx(c,{for:"payment_amount",value:"Client Payment"}),t.jsx("input",{type:"number",placeholder:"Enter Payment Amount",className:"w-full rounded-md border p-2",value:a.payment_amount,onChange:e=>l("payment_amount",e.target.value)}),t.jsx(u,{message:d.payment_amount}),t.jsx(c,{for:"remarks",value:"Remarks/Note:"}),t.jsx(J,{className:"w-full",value:a.remarks,onChange:e=>l("remarks",e.target.value)}),t.jsx(u,{message:d.remarks}),x&&a.cart.length>0?x.map((e,r)=>t.jsx("button",{onClick:()=>M(e.id),className:`m-2 rounded-xl p-2 ${a.discount_id===e.id?"bg-yellow-700 text-white":"bg-yellow-400 hover:bg-yellow-700 hover:text-white"}`,children:e.name},r)):t.jsx("h1",{children:"No Discounts Available"}),t.jsxs("p",{className:"mt-2 text-lg font-bold",children:["Grand Total: ₱",v.toFixed(2)]}),t.jsx("p",{className:`mt-2 text-lg ${_<0?"text-red-500":"text-green-500"}`,children:_<0?`Balance Due: ₱${Math.abs(_).toFixed(2)}`:`Change: ₱${_.toFixed(2)}`}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Upload Payment Images (Multiple Allowed)"}),t.jsx("input",{type:"file",name:"images",multiple:!0,onChange:Q,className:"border p-2 rounded"}),d.images&&t.jsx("div",{className:"text-red-500 mt-2",children:d.images}),N.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h2",{className:"text-lg font-bold",children:"Selected Files:"}),t.jsx("ul",{className:"list-disc list-inside",children:N.map((e,r)=>t.jsx("li",{className:"text-gray-700",children:e.name},r))})]})]}),t.jsx("button",{onClick:G,className:`${a.cart.length===0||a.courier_id===""||a.payment_method_id===""?"bg-green-700":"bg-green-500 "} mt-2 w-full rounded-md px-4 py-2 text-white`,disabled:a.cart.length===0||a.courier_id===""||a.payment_method_id==="",children:"Process Sale"})]})]})]})})};export{re as default};
