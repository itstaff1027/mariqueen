import{r as l,j as e,h as U,b as q}from"./app-CNtLemjm.js";import{I as B}from"./InventoryLayout-DiNKVmRZ.js";import{I as u}from"./InputError-Bv2Dc47b.js";import{I as Q}from"./InputLabel-D_t4371S.js";import{$ as z,a as G}from"./useFocusRing-iPzQWdB9.js";import{w as H}from"./use-active-press-BSiNO5VL.js";import{a as M,U as O}from"./description-C-eiljcF.js";import{u as J,I as X}from"./label-o0yjZmJF.js";import{K as Y,_ as Z,L as ee}from"./use-sync-refs-Bn8sev2R.js";import"./Dropdown-CX_2cq7m.js";import"./transition-BHL_Jt7j.js";import"./AuthenticatedLayout-DFlyvMr1.js";import"./ApplicationLogo-Dz0w4Zzv.js";import"./SubNavigation-DtQYuMff.js";import"./ResponsiveNavLink-BI4DjDTS.js";import"./owner-B14CThBL.js";let se="select";function ae(j,g){let F=l.useId(),v=J(),n=M(),{id:p=v||`headlessui-select-${F}`,disabled:d=n||!1,invalid:x=!1,autoFocus:o=!1,..._}=j,c=X(),N=O(),{isFocusVisible:b,focusProps:y}=z({autoFocus:o}),{isHovered:k,hoverProps:C}=G({isDisabled:d}),{pressed:T,pressProps:S}=H({disabled:d}),m=Z({ref:g,id:p,"aria-labelledby":c,"aria-describedby":N,"aria-invalid":x?"":void 0,disabled:d||void 0,autoFocus:o},y,C,S),R=l.useMemo(()=>({disabled:d,invalid:x,hover:k,focus:b,active:T,autofocus:o}),[d,x,k,b,T,o]);return ee()({ourProps:m,theirProps:_,slot:R,defaultTag:se,name:"Select"})}let te=Y(ae);const ve=({product_variants:j,warehouses:g,stock_levels:F,batches:v})=>{const[n,p]=l.useState([]),[d,x]=l.useState({}),[o,_]=l.useState("purchase"),[c,N]=l.useState(""),[b,y]=l.useState("");l.useState("draft");const[k,C]=l.useState(""),[T,S]=l.useState(j),[m,R]=l.useState([]),[i,P]=l.useState("");l.useEffect(()=>{if(console.log(c),o==="transfer"&&c){const s=m.filter(a=>a.warehouse_id.toString()===c.toString()).map(a=>a.product_variant);S(s)}else S(j)},[o,c,m]);const E=()=>{const s=n.map(a=>a.sku).filter(Boolean);return j.filter(a=>!s.includes(a.sku))},$=()=>{const s=n.map(r=>r.sku).filter(Boolean),a=m.map(r=>r.product_variant);return console.log(m),a.filter(r=>!s.includes(r.sku))},V=()=>{p([...n,{id:"",sku:"",quantity:""}])},A=s=>{p(n.filter((a,r)=>r!==s))},W=(s,a,r)=>{const f=n.map((t,h)=>h===s?{...t,[a]:r}:t);p(f)},I=(s,a,r)=>{const f=n.map((t,h)=>h===s?{...t,sku:a,id:r}:t);p(f),x(t=>({...t,[s]:!1}))},w=s=>{x(a=>({...a,[s]:!a[s]}))},L=s=>{_(s.target.value),N(""),y(""),p([])},D=s=>{s.preventDefault();const a={transaction_type:o,remarks:k,from_warehouse_id:o==="transfer"?c:null,to_warehouse_id:b,products:n.map(r=>({product_variant_id:r.id,quantity:r.quantity}))};console.log(a),U.post("/inventory/stock/transactions",a,{onError:r=>{P(r),console.log(r)}})},K=s=>{q.get(route("stock_movements",{id:s})).then(a=>{console.log(a.data),R(a.data)}).catch(a=>{console.error("Error fetching data:",a)})};return e.jsx(B,{header:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Stock Transactions"})}),children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Stock Transactions"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded shadow hover:bg-green-600 mt-4",onClick:D,children:"Submit"}),e.jsx("button",{onClick:V,className:"bg-blue-500 text-white px-4 py-2 rounded shadow hover:bg-blue-600",children:"Add Row"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Transaction Type:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:o,onChange:L,children:[e.jsx("option",{value:"purchase",children:"Purchase"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"adjustment",children:"Adjustment"}),e.jsx("option",{value:"correction",children:"Correction"}),e.jsx("option",{value:"repair",children:"Repair"}),e.jsx("option",{value:"transfer",children:"Transfer"})]}),e.jsx(u,{message:i.transaction_type})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"General Remarks:"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-4 py-2",placeholder:"Enter general remarks for this transaction",value:k,onChange:s=>C(s.target.value)}),e.jsx(u,{message:i.remarks})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(Q,{for:"batch_id",value:"Select Batch"}),e.jsx(te,{children:v==null?void 0:v.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),o==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Source Warehouse:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:c,onChange:s=>{N(s.target.value),K(s.target.value)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Source Warehouse"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(u,{message:i.from_warehouse_id})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Target Warehouse:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:b,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Target Warehouse"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(u,{message:i.to_warehouse_id})]})]}):e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-bold mb-2",children:"Warehouse:"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-4 py-2",value:b,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Warehouse"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(u,{message:i.to_warehouse_id})]}),e.jsxs("table",{className:"w-full table-auto border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border px-4 py-2",children:"Product SKU"}),e.jsx("th",{className:"border px-4 py-2",hidden:o!=="transfer",children:"Available Stocks"}),e.jsx("th",{className:"border px-4 py-2",children:"Quantity"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:n.map((s,a)=>{var f;const r=((f=m.find(t=>t.product_variant_id===s.id))==null?void 0:f.total_stock)||0;return e.jsxs("tr",{children:[e.jsxs("td",{className:"relative border px-4 py-2",children:[o==="transfer"?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"w-full rounded border px-2 py-1",placeholder:"Search SKU (Transfer)",value:s.sku,onChange:t=>{W(a,"sku",t.target.value),w(a)},onFocus:()=>w(a)}),e.jsx(u,{message:i.products.index.product_variant_id})]}):e.jsx(e.Fragment,{children:e.jsx("input",{type:"text",className:"w-full rounded border px-2 py-1",placeholder:"Search SKU (Purchase)",value:s.sku,onChange:t=>{W(a,"sku",t.target.value),w(a)},onFocus:()=>w(a)})}),o==="transfer"?d[a]&&e.jsx("ul",{className:"absolute z-10 max-h-40 w-full overflow-y-auto rounded border bg-white",children:$().map(t=>e.jsx("li",{className:"cursor-pointer px-4 py-2 hover:bg-gray-200",onClick:()=>I(a,t.sku,t.id),children:t.sku},t.id))}):d[a]&&e.jsx("ul",{className:"absolute z-10 max-h-40 w-full overflow-y-auto rounded border bg-white",children:E().filter(t=>t.sku.toLowerCase().includes(s.sku.toLowerCase())).map(t=>e.jsx("li",{className:"cursor-pointer px-4 py-2 hover:bg-gray-200",onClick:()=>I(a,t.sku,t.id),children:t.sku},t.id))})]}),o==="transfer"&&e.jsx("td",{className:"border px-4 py-2 text-center",children:r>0?e.jsxs("span",{className:"font-bold text-green-600",children:[r," ","Available"]}):e.jsx("span",{className:"font-bold text-red-600",children:"Out of Stock"})}),e.jsxs("td",{className:"border px-4 py-2",children:[e.jsx("input",{type:"number",className:"w-full rounded border px-2 py-1",placeholder:"Enter Quantity",value:s.quantity,onChange:t=>{let h=parseInt(t.target.value,10)||0;o==="transfer"&&h>r&&(h=r),W(a,"quantity",h)},min:"1",max:o==="transfer"?r:"",disabled:o==="transfer"&&r===0}),e.jsx(u,{message:i.transaction_type})]}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("button",{type:"button",onClick:()=>A(a),className:"rounded bg-red-500 px-2 py-1 text-white shadow hover:bg-red-600",children:"Remove"})})]},a)})}),e.jsx(u,{message:i.products})]})]})})})};export{ve as default};
