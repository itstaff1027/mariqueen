import{r as D,j as e,h as F}from"./app-CDJ9BaRc.js";import{A as U}from"./AuthenticatedLayout-CiEq-52F.js";import"./ApplicationLogo-BqbaN8sQ.js";const V=({warehouse:k,ledgers:g,startDate:z,endDate:X,product_variants:p})=>{const[E,v]=D.useState(z),[L,O]=D.useState(X),C=()=>{F.get(`/inventory/warehouses/${k.id}/ledger`,{start_date:E,end_date:L},{preserveState:!0})},T=()=>{const l=["SKU","Product Name","Color","Size","Size Values","Heel Height","Categories","Movement Type","Date","Quantity"];let i=[];p.forEach(o=>{var t,a,r,f,u,N;const x=[o.sku,((t=o.product)==null?void 0:t.product_name)||"",((a=o.colors)==null?void 0:a.color_name)||"",((r=o.sizes)==null?void 0:r.size_name)||"",((f=o.size_values)==null?void 0:f.size_values)||"",((u=o.heel_heights)==null?void 0:u.value)||"",((N=o.categories)==null?void 0:N.category_name)||""],c=g[o.id];if(c&&c.byDate)Object.entries(c.byDate).sort((y,S)=>y[0].localeCompare(S[0])).forEach(([y,S])=>{(S.entries||[]).forEach(w=>{const _=[...x,w.movement_type,y,Number(w.total_change)];i.push(_)})});else{const j=[...x,"","",""];i.push(j)}});const s=[l,...i],d=XLSX.utils.aoa_to_sheet(s),h=l.map((o,x)=>{let c=o?o.toString().length:10;return s.forEach(t=>{const a=t[x];a&&(c=Math.max(c,a.toString().length))}),{wch:c+2}});d["!cols"]=h;const m=XLSX.utils.book_new();XLSX.utils.book_append_sheet(m,d,"Simple Stock Ledger"),XLSX.writeFile(m,`${k.name}_Simple_Stock_Ledger_${new Date().toISOString().split("T")[0]}.xlsx`)},$=()=>{let l=new Set;p.forEach(t=>{const a=g[t.id];a&&a.byDate&&Object.keys(a.byDate).forEach(r=>l.add(r))});let i=Array.from(l).sort(),d=[...["SKU","Product Name","Color","Size","Size Values","Heel Height","Categories"]];i.forEach(t=>{d.push(`${t} (Purchase)`,`${t} (Transfer Out)`,`${t} (Transfer In)`,`${t} (Running Balance)`,`${t} (Sold)`)});let h=[];p.forEach(t=>{var r,f,u,N,j,y;let a=[];a.push(t.sku,((r=t.product)==null?void 0:r.product_name)||"",((f=t.colors)==null?void 0:f.color_name)||"",((u=t.sizes)==null?void 0:u.size_name)||"",((N=t.size_values)==null?void 0:N.size_values)||"",((j=t.heel_heights)==null?void 0:j.value)||"",((y=t.categories)==null?void 0:y.category_name)||""),i.forEach(S=>{let w=g[t.id]&&g[t.id].byDate&&g[t.id].byDate[S]||{entries:[],running_balance:0};const _=w.entries||[],H=_.filter(n=>n.movement_type==="purchase").reduce((n,b)=>n+Number(b.total_change),0),P=_.filter(n=>n.movement_type==="transfer_out").reduce((n,b)=>n+Number(b.total_change),0),R=_.filter(n=>n.movement_type==="transfer_in").reduce((n,b)=>n+Number(b.total_change),0),I=_.filter(n=>n.movement_type==="sold").reduce((n,b)=>n+Number(b.total_change),0),B=Number(w.running_balance??0);a.push(H,P,R,I,B)}),h.push(a)});const m=[d,...h],o=XLSX.utils.aoa_to_sheet(m),x=d.map((t,a)=>{let r=t?t.toString().length:10;return m.forEach(f=>{const u=f[a];u&&(r=Math.max(r,u.toString().length))}),{wch:r+2}});o["!cols"]=x;const c=XLSX.utils.book_new();XLSX.utils.book_append_sheet(c,o,"Stock Ledger"),XLSX.writeFile(c,`${k.name}_Stock_Ledger_${new Date().toISOString().split("T")[0]}.xlsx`)};return D.useEffect(()=>{console.log(p)},[]),e.jsx(U,{header:e.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Stock Ledger for ",k.name]}),children:e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"From Date:"}),e.jsx("input",{type:"date",value:E,onChange:l=>v(l.target.value),className:"border rounded p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"To Date:"}),e.jsx("input",{type:"date",value:L,onChange:l=>O(l.target.value),className:"border rounded p-2"})]}),e.jsx("button",{onClick:C,className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Update Ledger"}),e.jsx("button",{onClick:$,className:"bg-green-500 text-white px-4 py-2 rounded",children:"Export to Excel"}),e.jsx("button",{onClick:T,className:"bg-purple-500 text-white px-4 py-2 rounded",children:"Export Simple Ledger"})]}),Object.entries(g).length===0?e.jsx("p",{className:"text-center text-gray-600",children:"No transactions found for this warehouse."}):Object.entries(g).map(([l,i])=>{var t;const s=p?p.find(a=>a.id===parseInt(l)):p.find(a=>a.id===parseInt(l));let d=0,h=0,m=0,o=0;i.byDate&&Object.values(i.byDate).forEach(a=>{(a.entries||[]).forEach(r=>{r.movement_type==="purchase"?d+=Number(r.total_change):r.movement_type==="transfer_out"?h+=Number(r.total_change):r.movement_type==="transfer_in"?m+=Number(r.total_change):r.movement_type==="sold"&&(o+=Number(r.total_change))})});const x=d+m+(h-o),c=Number(i.opening_balance)+x;return e.jsxs("div",{className:"mb-8 p-4 bg-white shadow rounded-lg",children:[e.jsxs("div",{className:"mb-4 border-b pb-2",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Product Variant ID: ",l," - Opening Balance: ",i.opening_balance]}),e.jsxs("h4",{className:"text-md text-gray-700",children:["SKU: ",(s==null?void 0:s.sku)||"N/A"," - ",((t=s==null?void 0:s.product)==null?void 0:t.product_name)||"Unnamed Product"]}),s&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-sm text-gray-600",children:[s.colors&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded",children:s.colors.color_name}),s.sizes&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded",children:s.sizes.size_name}),s.size_values&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded",children:s.size_values.size_values}),s.heelHeights&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded",children:s.heelHeights.value}),s.categories&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded",children:s.categories.category_name})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Purchase"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Transfer Out"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Transfer In"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Sold"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-100",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:d}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:h}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:m}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:o})]}),e.jsxs("tr",{className:"bg-gray-100",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-gray-700",colSpan:"2",children:["Net Change: ",x]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-gray-700",colSpan:"2",children:["Running Balance: ",c]})]})]})]})})]},l)})]})})})})};export{V as default};
